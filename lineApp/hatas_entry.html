<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>スプレッドシートテスト</title>
</head>
<body>
  <h2>スプレッドシートテスト</h2>
  <button id="btnRecord">テスト記録</button>
  <p id="status"></p>

  <script>
    // 公開済みのWebアプリURLに置き換え
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbxUUQqRuB10HwazkC5L_YdWna861F-LfraK3wyMF56TqE3u-qgDcUOuSZa4q6WAWAuvk/exec';

    const userId = 'test_user_id';
    const userName = 'テスト太郎';

    const btn = document.getElementById('btnRecord');

    btn.onclick = async () => {
      btn.disabled = true;
      document.getElementById('status').textContent = '通信中...';

      try {
        const res = await fetch(GAS_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ userId, userName }),
        });
        const json = await res.json();

        if (json.result === 'success') {
          document.getElementById('status').textContent = 'テスト記録が完了しました！';
        } else {
          document.getElementById('status').textContent = 'GASからの応答にエラーがあります。';
          console.error(json);
        }
      } catch (e) {
        document.getElementById('status').textContent = '通信エラーが発生しました。';
        console.error(e);
      } finally {
        btn.disabled = false;
      }
    };
  </script>
</body>
</html>

<!-- <!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>来店記録アプリ</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h2>来店ありがとうございます！</h2>
  <button id="btnRecord" disabled>来店を記録する</button>
  <p id="status"></p>

  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycby9bDFbsaJjo2Er9FwJpEIY41xo4ho55WRoFkX3LeMhqYbkGt--VoN6EG_RaFlQNhpo/exec'; // 公開済みのWebアプリURLに置き換え
    const FRIEND_ADD_URL = 'https://lin.ee/HP6W8NM';

    async function checkFriendStatus(userId) {
      // とりあえず常にtrue返すダミー実装
      return true;
    }

    async function main() {
      try {
        await liff.init({ liffId: '2007867087-B6Vy7nGv' });

        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }

        const profile = await liff.getProfile();
        const userId = profile.userId;
        const userName = profile.displayName;

        // 友だち判定
        const isFriend = await checkFriendStatus(userId);

        if (!isFriend) {
          if (confirm("まだ友だち登録されていません。友だち登録ページを開きますか？")) {
            liff.openWindow({ url: FRIEND_ADD_URL });
          }
          document.getElementById('status').textContent = '友だち登録が必要です。';
          return;
        }

        // 友だちならボタン有効化
        const btn = document.getElementById('btnRecord');
        btn.disabled = false;

        btn.onclick = async () => {
          btn.disabled = true;
          document.getElementById('status').textContent = '通信中...';

          try {
            const res = await fetch(GAS_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ userId, userName }),
            });
            const json = await res.json();

            document.getElementById('status').textContent = '来店記録が完了しました。ありがとうございます！';
          } catch (e) {
            document.getElementById('status').textContent = '通信エラーが発生しました。';
            btn.disabled = false;
          }
        };

      } catch (e) {
        document.getElementById('status').textContent = '初期化エラーが発生しました。';
        console.error(e);
      }
    }

    main();
  </script>
</body>
</html> -->
