<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>畑瀬来店</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; font-size: 18px; }
    .question { margin-bottom: 20px; }
    button { padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h2 id="greeting">読み込み中...</h2>

  <div id="form-area" style="display: none;">
    <button onclick="submitSurvey()">来店しました。</button>
  </div>



  <p id="result" style="font-weight: bold; margin-top: 20px;"></p>

  <script>
    async function main() {
      try {
        await liff.init({ liffId: "2007867087-B6Vy7nGv" });

        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }

        const profile = await liff.getProfile();

        user_id = profile.userId;
        displayName = profile.displayName;

        document.getElementById("greeting").textContent =
          `こんにちは、${displayName}さん！`;

        document.getElementById("form-area").style.display = "block";
      } catch (err) {
        document.getElementById("greeting").textContent = "LIFF初期化に失敗しました。";
        console.error(err);
      }
    }

    async function submitSurvey() {
    const payload = {
      userName: displayName,
      userId: user_id
    };

    try {
      await fetch("https://script.google.com/macros/s/AKfycbw-Btkf_-9wKKxrZU_IUM_uJs-VycbSouZYWE1oElu_GgVMvm79YDnCOwiAE4wwoFdw/exec", {
        method: "POST",
        mode: "no-cors",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      // fetch 成功とみなして表示を切り替える
      window.location.href = "./hatas_entered.html";
      // document.getElementById("form-area").style.display = "none";
      // document.getElementById("result").textContent = "ご来店誠にありがとうございます！";

    } catch (err) {
      console.error("送信エラー:", err);
      alert("送信中にエラーが発生しました。");
    }
  }
  main();
</script>
</body>
</html>
